<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<div layout:fragment="content">
	<div class="page-wrapper">
		<div class="main-content">
			<aside class="sidebar">
				<h2 class="sidebar-title">ã‚«ãƒ†ã‚´ãƒªãƒ¼</h2>
				<div class="filter-group">
					<label><input type="checkbox"> å¤©æ°—æƒ…å ±</label> <label><input
						type="checkbox"> ç½å®³æƒ…å ±</label> <label><input
						type="checkbox"> é¿é›£æ‰€æƒ…å ±</label> <label><input
						type="checkbox"> ç—…é™¢æƒ…å ±</label>
				</div>
			</aside>

			<main class="content-area">
				<!-- ì§€ë„ ì˜ì—­ -->
				<section class="map-section">
					<div id="map" class="map-canvas"></div>
				</section>

				<h2 class="section-title">í˜„ì¬ ì§€ì—­ ìƒì„¸ ì •ë³´</h2>
				<div class="card-list">
					<a href="#">
						<div class="card-icon">ğŸ—ºï¸</div>
						<div class="card-content">
							<h4>ì£¼ë³€ ëŒ€í”¼ì†Œ ëª©ë¡</h4>
							<p>í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œë¥¼ í™•ì¸í•˜ê³  ê²½ë¡œë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤.</p>
						</div>
						<div class="card-arrow">&gt;</div>
					</a> <a href="#">
						<div class="card-icon">ğŸ“°</div>
						<div class="card-content">
							<h4>ìµœì‹  ì¬ë‚œ ë‰´ìŠ¤</h4>
							<p>í˜„ì¬ ì§€ì—­ê³¼ ê´€ë ¨ëœ ìµœì‹  ì¬ë‚œ ì†ë³´ ë° ì•ˆì „ ë¬¸ìë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
						</div>
						<div class="card-arrow">&gt;</div>
					</a> <a href="#">
						<div class="card-icon">ğŸ’</div>
						<div class="card-content">
							<h4>ìƒí™©ë³„ í–‰ë™ ìš”ë ¹</h4>
							<p>ì§€ì§„, íƒœí’, í™”ì¬ ë“± í˜„ì¬ ìƒí™©ì— ë§ëŠ” í–‰ë™ ìš”ë ¹ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.</p>
						</div>
						<div class="card-arrow">&gt;</div>
					</a>
				</div>
			</main>
		</div>
	</div>
</div>

<th:block layout:fragment="script">
	<script
	  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdiJWNOl98gTR6XjCfDhubMwXQZVO3ejs&callback=initMap"
	  async defer>
	</script>
	<script>
	    // ë‚ ì”¨ ì½”ë“œ â†’ ì•„ì´ì½˜ ë§¤í•‘
	    function getWeatherIcon(code) {
	      if (code.includes("æ™´")) return "â˜€ï¸";
	      if (code.includes("ãã‚‚ã‚Š")) return "â›…";
	      if (code.includes("é›¨")) return "ğŸŒ§ï¸";
	      if (code.includes("é›·")) return "â›ˆï¸";
	      if (code.includes("é›ª")) return "â„ï¸";
	      return "â“";
	    }
	
	    async function fetchWeather(lat, lon) {
	      const url = "https://www.jma.go.jp/bosai/forecast/data/forecast/130000.json";
	      const res = await fetch(url);
	      const data = await res.json();
	
	      // ë‹¨ìˆœíˆ í˜„ì¬ ë‚ ì”¨ì™€ ê¸°ì˜¨ ì¶”ì¶œ
	      const weather = data[0].timeSeries[0].areas[0].weathers[0];
	      const temp = data[0].timeSeries[2].areas[0].temps[0];
	
	      return { weather, temp };
	    }
	
	    async function initMap() {
	      const tokyo = { lat: 35.6812, lng: 139.7671 };
	
	      const map = new google.maps.Map(document.getElementById("map"), {
	        center: tokyo,
	        zoom: 8
	      });
	
	      // ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
	      const { weather, temp } = await fetchWeather(tokyo.lat, tokyo.lng);
	      const icon = getWeatherIcon(weather);
	
	      // ì§€ë„ì— ë§ˆì»¤ ìƒì„± (ì•„ì´ì½˜ + ê¸°ì˜¨ í‘œì‹œ)
	      new google.maps.Marker({
	        position: tokyo,
	        map,
	        label: {
	          text: `${icon} ${temp}Â°C`,
	          fontSize: "30px",
	          fontWeight: "bold"
	        },
	        title: `ë„ì¿„ ë‚ ì”¨: ${weather}, ${temp}Â°C`
	      });
	    }
	  </script>
</th:block>
</html>
