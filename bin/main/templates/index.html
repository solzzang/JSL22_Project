<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<div layout:fragment="content">
	<div class="page-wrapper">
		<div class="main-content">
			<aside class="sidebar">
				<h2 class="sidebar-title">カテゴリー</h2>
				<div class="filter-group">
					<label><input type="checkbox"> 天気情報</label> <label><input
						type="checkbox"> 災害情報</label> <label><input
						type="checkbox"> 避難所情報</label> <label><input
						type="checkbox"> 病院情報</label>
				</div>
			</aside>

			<main class="content-area">
				<!-- 지도 영역 -->
				<section class="map-section">
					<div id="map" class="map-canvas"></div>
				</section>

				<h2 class="section-title">현재 지역 상세 정보</h2>
				<div class="card-list">
					<a href="#">
						<div class="card-icon">🗺️</div>
						<div class="card-content">
							<h4>주변 대피소 목록</h4>
							<p>현재 위치에서 가장 가까운 대피소를 확인하고 경로를 안내합니다.</p>
						</div>
						<div class="card-arrow">&gt;</div>
					</a> <a href="#">
						<div class="card-icon">📰</div>
						<div class="card-content">
							<h4>최신 재난 뉴스</h4>
							<p>현재 지역과 관련된 최신 재난 속보 및 안전 문자를 확인합니다.</p>
						</div>
						<div class="card-arrow">&gt;</div>
					</a> <a href="#">
						<div class="card-icon">🎒</div>
						<div class="card-content">
							<h4>상황별 행동 요령</h4>
							<p>지진, 태풍, 화재 등 현재 상황에 맞는 행동 요령을 안내합니다.</p>
						</div>
						<div class="card-arrow">&gt;</div>
					</a>
				</div>
			</main>
		</div>
	</div>
</div>

<th:block layout:fragment="script">
	<script
	  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdiJWNOl98gTR6XjCfDhubMwXQZVO3ejs&callback=initMap"
	  async defer>
	</script>
	<script>
	    // 날씨 코드 → 아이콘 매핑
	    function getWeatherIcon(code) {
	      if (code.includes("晴")) return "☀️";
	      if (code.includes("くもり")) return "⛅";
	      if (code.includes("雨")) return "🌧️";
	      if (code.includes("雷")) return "⛈️";
	      if (code.includes("雪")) return "❄️";
	      return "❓";
	    }
	
	    async function fetchWeather(lat, lon) {
	      const url = "https://www.jma.go.jp/bosai/forecast/data/forecast/130000.json";
	      const res = await fetch(url);
	      const data = await res.json();
	
	      // 단순히 현재 날씨와 기온 추출
	      const weather = data[0].timeSeries[0].areas[0].weathers[0];
	      const temp = data[0].timeSeries[2].areas[0].temps[0];
	
	      return { weather, temp };
	    }
	
	    async function initMap() {
	      const tokyo = { lat: 35.6812, lng: 139.7671 };
	
	      const map = new google.maps.Map(document.getElementById("map"), {
	        center: tokyo,
	        zoom: 8
	      });
	
	      // 날씨 정보 가져오기
	      const { weather, temp } = await fetchWeather(tokyo.lat, tokyo.lng);
	      const icon = getWeatherIcon(weather);
	
	      // 지도에 마커 생성 (아이콘 + 기온 표시)
	      new google.maps.Marker({
	        position: tokyo,
	        map,
	        label: {
	          text: `${icon} ${temp}°C`,
	          fontSize: "30px",
	          fontWeight: "bold"
	        },
	        title: `도쿄 날씨: ${weather}, ${temp}°C`
	      });
	    }
	  </script>
</th:block>
</html>
